#!/bin/sh

. .tests/common/common.sh

run_script=""
default_host=172.44.0.2
default_port=80

if test $# -eq 1; then
    echo "Host and port unspecified." 1>&2
    host="$default_host"
    port="$default_port"
elif test $# -eq 3; then
    host="$2"
    port="$3"
else
    echo "Unknown arguments." 1>&2
    echo "Usage: $0 [<port>]" 1>&2
    exit 1
fi
echo "Using as remote $host:$port" 1>&2

# Clean up previous instances.
clean_up

# Start instance.
start_instance

# Wait for start.
sleep 3

# Query non-localhost (NAT networking) instance.
if test ! "$host" = "localhost" -a ! "$host" = "127.0.0.1"; then
    test_ping "$host"
fi

# Connect via HTTP.
test_curl_connect "$host" "$port"

# Connect via HTTP and check reply.
test_curl_check_reply "$host" "$port" "Hello from Unikraft!"

# Stop instance.
end_with_success
